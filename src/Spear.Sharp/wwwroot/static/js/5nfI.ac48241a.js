(window.webpackJsonp=window.webpackJsonp||[]).push([["5nfI"],{"5nfI":function(e,t,i){"use strict";i.r(t);var l=i("P2sY"),a=i.n(l),n=i("t3Un"),o={name:"DatabaseCreate",props:{value:{type:Object,required:!1,default:function(){}},show:{type:Boolean,required:!0,default:function(){return!1}}},data:function(){return{title:"创建数据库连接",dialogVisible:this.show,create:!0,providers:[{key:0,value:"SqlServer"},{key:1,value:"MySql"},{key:2,value:"PostgreSql"},{key:3,value:"SQLite"}],model:a()({detail:{}},this.value),rules:{name:[{required:!0,message:"请输入文档名称",trigger:"blur"},{min:2,max:15,message:"长度在 2 到 15 个字符",trigger:"blur"}],code:[{required:!0,message:"请输入文档编码",trigger:"blur"},{min:2,max:15,message:"长度在 2 到 15 个字符",trigger:"blur"}],provider:[{required:!0,message:"请选择数据库驱动",trigger:"change"}],connectionString:[{required:!0,message:"请输入数据库连接字符",trigger:"blur"}]}}},watch:{show:function(e){this.dialogVisible=e},dialogVisible:function(e){this.$emit("visibleChange",e)},value:function(e){this.create=!e||!e.id,this.create?(this.model={detail:{}},this.title="创建数据库连接"):(this.model=e,this.title="编辑数据库连接")}},methods:{handleSave:function(){var e=this;console.log(this.model),this.$refs.docForm.validate(function(t){if(console.log(t),!t)return!1;e.create?function(e){var t=e.name,i=e.code,l=e.provider,a=e.connectionString;return n.a.post("/api/database",{name:t,code:i,provider:l,connectionString:a})}(e.model).then(function(t){e.$message.success(e.title+"成功"),e.dialogVisible=!1,e.$emit("success")}):function(e){var t=e.id,i=e.name,l=e.code,a=e.provider,o=e.connectionString;return n.a.put("/api/database/"+t,{name:i,code:l,provider:a,connectionString:o})}(e.model).then(function(t){e.$message.success(e.title+"成功"),e.dialogVisible=!1,e.$emit("success")})})}}},r=i("KHd+"),s=Object(r.a)(o,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{visible:e.dialogVisible,title:e.title,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{ref:"docForm",attrs:{model:e.model,rules:e.rules,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"名称",prop:"name"}},[i("el-input",{staticStyle:{width:"20rem"},attrs:{placeholder:"请输入连接名称"},model:{value:e.model.name,callback:function(t){e.$set(e.model,"name",t)},expression:"model.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"编码",prop:"code"}},[i("el-input",{staticStyle:{width:"20rem"},attrs:{placeholder:"请输入编码"},model:{value:e.model.code,callback:function(t){e.$set(e.model,"code",t)},expression:"model.code"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"数据库驱动",prop:"provider"}},[i("el-select",{attrs:{placeholder:"选择类型"},model:{value:e.model.provider,callback:function(t){e.$set(e.model,"provider",t)},expression:"model.provider"}},e._l(e.providers,function(e){return i("el-option",{key:e.key,attrs:{value:e.key,label:e.value}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"数据库连接",prop:"connectionString"}},[i("el-input",{attrs:{placeholder:"请输入数据库连接",type:"textarea"},model:{value:e.model.connectionString,callback:function(t){e.$set(e.model,"connectionString",t)},expression:"model.connectionString"}})],1)],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.handleSave}},[e._v("确 定")])],1)],1)},[],!1,null,null,null);s.options.__file="Create.vue";var c={name:"DbDoc",components:{Create:s.exports},data:function(){return{query:{keyword:void 0,type:void 0,page:1,size:10},loading:!1,showCreate:!1,current:void 0,total:0,providers:[{key:0,value:"SqlServer"},{key:1,value:"MySql"},{key:2,value:"PostgreSql"},{key:3,value:"SQLite"}],list:[]}},mounted:function(){this.loadList()},methods:{indexMethod:function(e){return(this.query.page-1)*this.query.size+e+1},loadList:function(){var e=this;this.loading=!0,function(e){var t=e.keyword,i=e.type,l=e.page,a=void 0===l?1:l,o=e.size,r=void 0===o?10:o;return n.a.get("/api/database",{params:{keyword:t,type:i,page:a,size:r}})}(this.query).then(function(t){e.total=t.total,e.list=t.data,e.loading=!1}).catch(function(t){e.loading=!1})},handleSearch:function(){this.page=1,this.loadList()},handleCreateVisible:function(e){this.showCreate=e},handleCreate:function(e){this.current=a()({},e||{}),this.showCreate=!0},handleRemove:function(e){var t=this;this.$confirm("确认要删除该数据库连接吗？").then(function(){(function(e){return n.a.delete("/api/database/"+e)})(e.id).then(function(){t.$message.success("删除成功"),t.loadList()})})},viewUrl:function(e){return function(e){return"/tables/"+e.code}(e)}}},d=Object(r.a)(c,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("div",{staticClass:"filter-container"},[i("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"输入关键字"},model:{value:e.query.keyword,callback:function(t){e.$set(e.query,"keyword",t)},expression:"query.keyword"}}),e._v(" "),i("el-select",{staticClass:"filter-item",staticStyle:{width:"130px"},attrs:{placeholder:"数据库类型",clearable:""},model:{value:e.query.type,callback:function(t){e.$set(e.query,"type",t)},expression:"query.type"}},e._l(e.providers,function(e){return i("el-option",{key:e.key,attrs:{label:e.value,value:e.key}})})),e._v(" "),i("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v(e._s(e.$t("table.search")))]),e._v(" "),i("el-button",{staticClass:"filter-item",attrs:{type:"default",icon:"el-icon-plus"},on:{click:function(t){e.handleCreate()}}},[e._v("新建")])],1),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.list}},[i("el-table-column",{attrs:{index:e.indexMethod,type:"index"}}),e._v(" "),i("el-table-column",{attrs:{label:"类型",prop:"provider",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-tag",{attrs:{type:["","warning","success","danger"][t.row.provider]}},[e._v(e._s(t.row.providerCn))])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"名称",prop:"name",width:"200px"}}),e._v(" "),i("el-table-column",{attrs:{label:"编码",prop:"code",width:"120px"}}),e._v(" "),i("el-table-column",{attrs:{label:"连接字符",prop:"connectionString"}}),e._v(" "),i("el-table-column",{attrs:{label:"创建时间",prop:"createTime",width:"190px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("parseTime")(t.row.createTime))+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{label:e.$t("table.actions"),align:"center",width:"220","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("a",{staticClass:"el-button el-button--success el-button--mini is-circle",attrs:{href:e.viewUrl(t.row),target:"_blank",title:"查看文档"}},[i("i",{staticClass:"el-icon-view"})]),e._v(" "),4!==t.row.status?i("el-button",{attrs:{title:e.$t("table.edit"),type:"primary",size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(i){e.handleCreate(t.row)}}}):e._e(),e._v(" "),4!==t.row.status?i("el-button",{attrs:{title:e.$t("table.delete"),type:"danger",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(i){e.handleRemove(t.row)}}}):e._e()]}}])})],1),e._v(" "),i("create",{attrs:{value:e.current,show:e.showCreate},on:{visibleChange:e.handleCreateVisible,success:function(t){e.loadList()}}})],1)},[],!1,null,null,null);d.options.__file="index.vue";t.default=d.exports}}]);